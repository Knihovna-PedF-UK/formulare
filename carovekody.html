<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
	<title>Generování čárových kódů</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/tiny-brutalism.css">
  <script>
    //trik, abych mohl v importovaný knihovně použít moduly
    module = {};
  </script>
  <script src="js/carovekody.js" type="text/javascript"></script>
  <script src="js/texlive-compile.js" type="text/javascript"></script>
</head>
<body>
  <template id="carovykody_tex">
    \documentclass{article}
\usepackage[code=Code39,H=10mm, X=0.25mm]{makebarcode}
\usepackage[margin=0pt,paperwidth=8.27in,paperheight=11.69in,top=5mm,bottom=2mm]{geometry}
\usepackage{ncccropbox}
\usepackage{fontspec}
\setmainfont{Arial}
\pagestyle{empty}
\ExplSyntaxOn
\newcommand\carovykod[2]{%
  \cropbox[69.90mm][32mm]{%\kern 25mm
    \parbox{66mm}{
      \begin{center}
      \fontsize{11}{11}\selectfont
      Knihovna~PedF~UK\\[6pt]
      \barcode{#1}\\[2pt]
      #1\\[6pt]
      \fontsize{13}{13}\selectfont
      \textbf{#2}
      % \hspace{5mm}#1\hfill \textbf{#2}\hspace{5mm}\null
    \end{center}
    }
  }\BreakBox\newline%%
}%
\def\EmptyBox{\cropbox[69.90mm][32mm]{}\BreakBox\newline}
\newcount\BoxBreak
\def\truncdiv#1#2{((#1-(#2-1)/2)/#2)}
\def\moduloop#1#2{(#1-\truncdiv{#1}{#2}*#2)}
\def\modulo#1#2{\number\numexpr\moduloop{#1}{#2}\relax}
\def\BreakBox#1{%
	\advance\BoxBreak by 1\relax%
	\if\modulo\BoxBreak30 #1\fi%
  \allowbreak%
}
\ExplSyntaxOff
\begin{document}
\parindent=0pt

{{content}}
  
\end{document}


  </template>
  <header id="header">
    <menu><a href="./index.html">Domů</a> | <a href="./signatury.html">Signatury</a> | <a href="./signatura2.html">Signatury 2</a> | <a href="./carovekody.html">Čárové kódy</a></menu>

  </header>
  <h1>Generování čárových kódů</h1>

  <textarea id="pole" rows="10" cols="50" placeholder="Zadejte data"></textarea>
<details><summary>Nastavení</summary>
  <legend>Startovací řádek: <input id="row" value="1" /></legend>
  <legend>Startovací sloupec: <input id="column" value="1" /></legend>
</details>
<button id="nacti">Načíst data</button>
<button id="generovat">Generovat PDF</button>
<div id="tabulka"></div>

  <p>Z přírustkového seznamu zkopírujte čárové kódy a signatury. Příklad:</p>
  <table>
    <tr><td>2592241526</td><td>Be2458a</td></tr>
    <tr><td>2592241527</td><td>F58857</td></tr>
    <tr><td>2592241528</td><td>Be18696</td></tr>
  </table>
  <script type="text/javascript">
    let hodnoty = []
		const pole = document.getElementById('pole');
		const tabulka = document.getElementById('tabulka');
    const generovat = document.getElementById("generovat")
    const carovykody_tex = document.getElementById("carovykody_tex");
		nacti.addEventListener('click', () => {
      hodnoty =  parseTable(pole.value);
      if(hodnoty.length == 0){
        alert('Prosím, zadejte text obsahující tabulku s položkami oddělenými tabulátorem.');
      }else{
        console.log(hodnoty);
        renderTable(hodnoty, tabulka);
        generovat.style.visibility = "visible";
      }
    })
		generovat.addEventListener('click', () => {
      const texlive = new TeXLiveForm();
        // Načtení hodnot z inputů
      const rowValue = document.getElementById("row").value;
      const columnValue = document.getElementById("column").value;

      // Převod na integery
      const row = parseInt(rowValue, 10);
      const column = parseInt(columnValue, 10);
      const zacatek = (row - 1) * 3 + column - 1
      const latexCode = generateBarcodes(hodnoty, carovykody_tex.content.textContent, zacatek);
      console.log(latexCode)
      texlive.submit([
        {
          name: 'document.tex',
          content: latexCode
       }
      ], {
        engine: 'lualatex',
        return: 'pdf'
      });

    });
  </script>
</body>
</html>
